top_srcdir=@true_srcdir@
srcdir=$(top_srcdir)/ansi-tests

RM=rm -fr
MV=mv -f
MKDIR=mkdir -p

.PHONY: clisp sbcl normal safe ecl ecl_min

ecl:
	cp $(top_srcdir)/h/*.h ../h/
	(echo '(setf (logical-pathname-translations "SYS")'; \
	 echo "      '"'(("*.*" "../*.*")))'; \
	 echo '(setf (logical-pathname-translations "SRC")'; \
	 echo "      '"'(("*.*" "'$(srcdir)'/*.*")))'; \
	 echo '(load "$(srcdir)/tests")'; \
	 echo "(quit)") | ../ecl -dir ../
	true

ecl_min:
	cp $(top_srcdir)/src/h/*.h ../h/
	(echo '(load "bare.lsp")'; \
	 echo '(setf (logical-pathname-translations "SYS")'; \
	 echo "      '"'(("*.*" "../*.*")))'; \
	 echo '(setf (logical-pathname-translations "SRC")'; \
	 echo "      '"'(("*.*" "'$(srcdir)'/*.*")))'; \
	 echo '(sys::chdir "ansi-tests")'; \
	 echo '(in-package "CL-USER")'; \
	 echo '(load "$(srcdir)/tests")'; \
	 echo "(quit)") | (cd ..; ./ecl_min)
	true

clean:
	$(RM) *.erg *.o *.c *.h *.data
