;;;
;;; Configuration file for the remaining libraires of ECLS
;;;
;;;
;;; * Learn where we come from and where we go to
;;;
(in-package "SYSTEM")
(*make-special '*ecls-srcdir*) ; defparameter is missing
(*make-special '*ecls-builddir*)
(setq *ecls-srcdir* #P"@srcdir@/")
(setq *ecls-builddir* (sys::chdir *ecls-srcdir*))
(setq *system-directory* *ecls-builddir*)
(setq compiler::*cc-flags* (concatenate 'string compiler::*cc-flags* " -I@srcdir@/h -I@srcdir@/gmp "))

;;;
;;; * Load system builder tool
;;;
(in-package "CL-USER")
(load "@srcdir@/util/system.lsp")

;;;
;;; * We redefine this to force generation of source files
;;; in the object directory -- source files help debugging
;;; with GDB.
;;;
(defun sbt::sbt-compile-file (&rest s)
  (apply #'compiler::compile-file
	   (car s)
	   :c-file t :h-file t :data-file t :system-p t
	   (cdr s)))

#ifdef CLX
;;;
;;; * Compile and link MIT CLX extensions
;;;
(push :clx-ansi-common-lisp *features*)
(sys::chdir (merge-pathnames "clx/" sys::*ecls-builddir*))
(load "defsys.lsp")
(sbt::operate-on-system clx :library)

(sys::chdir sys::*ecls-builddir*)
(compiler::build-ecls "eclx"
#ifndef RUNTIME
	   'cmp
#endif
	   'clx
)
#endif CLX

